<!DOCTYPE html>
<html>
<head>
    <title>To-Do App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="theme-toggle">
        <button onclick="toggleTheme()" id="themeBtn">ğŸŒ™ Dark</button>
    </div>
    
    <h2>ğŸ“ To-Do List</h2>

    <form action="/todos" method="post" class="todo-form">

        <input type="text" name="title" placeholder="Add task..." required />
    
        <select name="priority">
            <option value="HIGH">ğŸ”´ High</option>
            <option value="MEDIUM" selected>ğŸŸ¡ Medium</option>
            <option value="LOW">ğŸŸ¢ Low</option>
        </select>
    
        <button>Add</button>
    </form>
    
    
    <input
    type="text"
    id="searchInput"
    placeholder="ğŸ” Search tasks..."
    class="search-box"
    onkeyup="searchTasks()"
/>


    <div class="filters">

        <a th:href="@{/todos}"
           th:classappend="${filter == null} ? 'active' : ''">
            All (<span th:text="${totalCount}"></span>)
        </a>
    
        <a th:href="@{/todos(filter='pending')}"
           th:classappend="${filter == 'pending'} ? 'active' : ''">
            Pending (<span th:text="${pendingCount}"></span>)
        </a>
    
        <a th:href="@{/todos(filter='completed')}"
           th:classappend="${filter == 'completed'} ? 'active' : ''">
            Completed (<span th:text="${completedCount}"></span>)
        </a>
    
    </div>
    

    <ul id="taskList">

        <li th:each="todo : ${todos}" th:attr="data-id=${todo.id}"
            th:classappend="${todo.completed} ? 'completed' : ''">
    
            <span th:text="${todo.title}"></span>
    
            <button onclick="toggleTask(this)">Done</button>
            <button onclick="deleteTask(this)" class="delete-btn">Delete</button>
            <span th:text="${todo.priority}"
      th:class="'badge ' + ${todo.priority.toLowerCase()}">
</span>

    
        </li>
    
    </ul>
    
    
</div>

<script>
function loadTasks() {
    fetch("/api/tasks")
        .then(res => res.json())
        .then(data => {
            const ul = document.getElementById("taskList");
            ul.innerHTML = "";

            data.forEach(task => {
                const li = document.createElement("li");
                if (task.status) li.classList.add("completed");

                const span = document.createElement("span");
                span.textContent = task.title;

                const actions = document.createElement("div");
                actions.className = "actions";

                const doneBtn = document.createElement("button");
                doneBtn.textContent = "Done";
                doneBtn.onclick = () => completeTask(task.id);

                const delBtn = document.createElement("button");
                delBtn.textContent = "Delete";
                delBtn.className = "delete";
                delBtn.onclick = () => deleteTask(task.id);

                actions.appendChild(doneBtn);
                actions.appendChild(delBtn);

                li.appendChild(span);
                li.appendChild(actions);
                ul.appendChild(li);
            });
        });
}

function addTask() {
    const input = document.getElementById("taskInput");
    const title = input.value.trim();
    if (!title) return;

    fetch("/api/tasks?title=" + encodeURIComponent(title), {
        method: "POST"
    }).then(() => {
        input.value = "";
        loadTasks();
    });

}

function completeTask(id) {
    fetch("/api/tasks/" + id, { method: "PUT" })
        .then(loadTasks);
}

function deleteTask(id) {
    fetch("/api/tasks/" + id, { method: "DELETE" })
        .then(loadTasks);
}

loadTasks();
</script>
<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this task?");
    }
    </script>
    
    <script src="/js/main.js"></script>

</body>
</html>
