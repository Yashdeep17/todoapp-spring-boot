<!DOCTYPE html>
<html>
<head>
    <title>To-Do App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h2>üìù To-Do List</h2>

    <form action="/todos" method="post">
        <input type="text" name="title" placeholder="Enter a task" required>
    
        <!-- üî• ADD THIS -->
        <input type="hidden" name="filter" th:value="${filter}">
    
        <button type="submit">Add</button>
    </form>
    

    <div class="filters">
        <a th:href="@{/todos}"
           th:classappend="${filter == null} ? 'active' : ''">All</a> |
    
        <a th:href="@{/todos(filter='pending')}"
           th:classappend="${filter == 'pending'} ? 'active' : ''">Pending</a> |
    
        <a th:href="@{/todos(filter='completed')}"
           th:classappend="${filter == 'completed'} ? 'active' : ''">Completed</a>
    </div>   

    <ul>
        <li th:each="todo : ${todos}">
            <form th:action="@{/todos/toggle}" method="post" style="display:inline;">
                <input type="hidden" name="taskId" th:value="${todo.id}">
                <input type="hidden" name="filter" th:value="${filter}">
                <button type="submit"
                        th:text="${todo.completed ? 'Undo' : 'Done'}">
                </button>
            </form>
            
            <form th:action="@{/todos/delete}"
      method="post"
      style="display:inline;"
      onsubmit="return confirmDelete()">

    <input type="hidden" name="taskId" th:value="${todo.id}">
    <input type="hidden" name="filter" th:value="${filter}">

    <button type="submit" class="delete-btn">
        Delete
    </button>
</form>

    
            <span th:text="${todo.title}"
                  th:style="${todo.completed} ? 'text-decoration: line-through;' : ''">
            </span>
            
        </li>
    </ul>
    
    
</div>

<script>
function loadTasks() {
    fetch("/api/tasks")
        .then(res => res.json())
        .then(data => {
            const ul = document.getElementById("taskList");
            ul.innerHTML = "";

            data.forEach(task => {
                const li = document.createElement("li");
                if (task.status) li.classList.add("completed");

                const span = document.createElement("span");
                span.textContent = task.title;

                const actions = document.createElement("div");
                actions.className = "actions";

                const doneBtn = document.createElement("button");
                doneBtn.textContent = "Done";
                doneBtn.onclick = () => completeTask(task.id);

                const delBtn = document.createElement("button");
                delBtn.textContent = "Delete";
                delBtn.className = "delete";
                delBtn.onclick = () => deleteTask(task.id);

                actions.appendChild(doneBtn);
                actions.appendChild(delBtn);

                li.appendChild(span);
                li.appendChild(actions);
                ul.appendChild(li);
            });
        });
}

function addTask() {
    const input = document.getElementById("taskInput");
    const title = input.value.trim();
    if (!title) return;

    fetch("/api/tasks?title=" + encodeURIComponent(title), {
        method: "POST"
    }).then(() => {
        input.value = "";
        loadTasks();
    });

}

function completeTask(id) {
    fetch("/api/tasks/" + id, { method: "PUT" })
        .then(loadTasks);
}

function deleteTask(id) {
    fetch("/api/tasks/" + id, { method: "DELETE" })
        .then(loadTasks);
}

loadTasks();
</script>
<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this task?");
    }
    </script>
    

</body>
</html>
